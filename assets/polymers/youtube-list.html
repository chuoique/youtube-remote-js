<polymer-element name="youtube-list">
  <style type="text/css">
    .youtube-media img {
      float: left;
    }
  </style>
  <template>

      <form id="playerhook"
    >   <div class='panel'>
          <input type="text" id="hookid" placeholder="enter player id">
        </div>
      </form>

    <form id="search">  
      <div class="panel">
        <input id="query" class="search" type="search" placeholder="search youtube..."></input>
      </div>
    </form>

    <div>
      <template id="yt-list" repeat="{{item in items}}">
          <div class="panel youtube-media">
        <h2>{{item.snippet.title}}</h2>
        <p>
          <img src="{{item.snippet.thumbnails.default.url}}">
          {{item.snippet.description}}
        </p>
        <button on-click="{{handleClick}}" videoid="{{item.id.videoId}}">play</button>

        <button on-click="{{handleStop}}">stop</button>
      </template>
    </div>
  </template>
  <script>
    Polymer('youtube-list', {
      ready: function() {
        var that = this;
        this.items = [{
            snippet: {
              title: 'loading...',
              description: ''
            }
          }
        ];
        this.$.search.addEventListener('submit', function(ev){
          that.query(that.$.query.value);
          ev.preventDefault();
        });

        this.$.playerhook.addEventListener('submit', function(ev){
          that.ytPlayerId = that.$.hookid.value;
          ev.preventDefault();
        });
        this.query('pearl jam');
      },

      handleClick: function (ev) {
        this.play(ev.target.getAttribute('videoid'));
      },

      handleStop: function(ev) {
        this.stop();
      }

      query: function(q){
        var that = this;
        $.ajax({
          url: '/search/list?q=' + q,
          success: function(res){  
            that.items = res.items;
            }
        })
      },

      play: function(videoId){
        sendCmd('clientList', {}, function(uuid){

            console.log(uuid);

            uuid.forEach(function(uuid){
              if(socket.uuid == uuid) return;
              sendCmd('play', {target: uuid, vidId: videoId});
            });

        });
      },

      stop: function(){
        sendCmd('clientList', {}, function(uuid){

            console.log(uuid);

            uuid.forEach(function(uuid){
              if(socket.uuid == uuid) return;
              sendCmd('stop', {target: uuid});
            });

        });
      }
    });
  </script>
</polymer-element>